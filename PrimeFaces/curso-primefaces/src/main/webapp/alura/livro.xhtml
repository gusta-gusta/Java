<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="_template.xhtml">
	<ui:define name="titulo">Cadastro de Livro</ui:define>
	<ui:define name="conteudo">
		<h:form id="form">

			<p:messages id="msg" closable="true">
				<p:autoUpdate />
			</p:messages>

			<p:panelGrid columns="2">

				<p:outputLabel value="Titulo: " />
				<p:inputText size="30" value="#{livroBean.livro.titulo}"
					required="false" label="Titulo"
					requiredMessage="Título obrigatório"
					validatorMessage="Título não pode ser superior a 40">
					<f:validateLength maximum="40" />
					<f:ajax event="blur" render="msg" />
				</p:inputText>

				<p:outputLabel value="ISBN: " />
				<p:inputMask mask="999-99-999-9999-9" size="13"
					value="#{livroBean.livro.isbn}"
					validator="#{livroBean.comecaComDigitoUm}" required="false"
					label="ISBN" />

				<p:outputLabel value="Preço: " />
				<p:inputText size="30" value="#{livroBean.livro.preco}"
					required="true" label="Preço">
					<f:convertNumber minFractionDigits="2" locale="pt-BR"
						minIntegerDigits="0" />
				</p:inputText>

				<p:outputLabel value="Data de Lançamento: " />
				<p:inputText size="30"
					value="#{livroBean.livro.dataLancamento.time}" required="true"
					label="Data de Lançamento">
					<f:convertDateTime pattern="dd/MM/yy" timeZone="America/Sao_Paulo" />
				</p:inputText>
				<p:outputLabel />

				<legend>Dados do Autor</legend>
				<h:outputLabel value="Selecione um Autor:" for="autor" />
				<h:selectOneMenu value="#{livroBean.autorId}" id="autor">
					<f:selectItems value="#{livroBean.autores}" var="autor"
						itemLabel="#{autor.nome}" itemValue="#{autor.id}" />
				</h:selectOneMenu>

				<p:commandButton value="Cadastrar Autor"
					action="#{livroBean.gravarAutor}" style="margin-top: 10px" />

				<p:commandLink value="Cadastrar NOVO Autor"
					action="#{livroBean.formAutor}" immediate="true" update="tabelaAutoresDosLivros">
					<f:ajax execute="@form" render="@form :tabelaAutoresDosLivros" />
					</p:commandLink>

				<p:dataTable value="#{livroBean.autoresDoLivro}" var="a" id="tabelaAutoresDosLivros"
					paginator="true" rows="10">
					<p:column headerText="Nome">
						<p:outputLabel value="#{a.nome}" />
					</p:column>
					</p:dataTable>

					<p:commandButton value="Cadastrar" action="#{livroBean.gravar}"
						style="margin-top: 10px" update="form tabelaLivros">
						<f:ajax execute="@form" render="@form :tabelaLivros" />
					</p:commandButton>
			</p:panelGrid>



			<p:dataTable value="#{livroBean.livros}" var="l" id="tabelaLivros"
				paginator="true" rows="10">
				<p:column headerText="Titulo">
					<p:outputLabel value="#{l.titulo}" />
				</p:column>

				<p:column headerText="ISBN">
					<p:outputLabel value="#{l.isbn}" />
				</p:column>

				<p:column headerText="Preço">
					<p:outputLabel value="#{l.preco}">
						<f:convertNumber type="currency" pattern="R$ #0.00"
							currencySymbol="R$" locale="pt_BR" />
					</p:outputLabel>
				</p:column>

				<p:column headerText="Data">
					<p:outputLabel value="#{l.dataLancamento.time}">
						<f:convertDateTime pattern="dd/MM/yyyy"
							timeZone="America/Sao_Paulo" />
					</p:outputLabel>
				</p:column>

				<p:column>
					<f:facet name="header">Editar</f:facet>
					<p:commandLink value="Editar" action="#{livroBean.editar(l)}" />
				</p:column>

				<p:column>
					<f:facet name="header">Remover</f:facet>
					<p:commandLink value="Remover" action="#{livroBean.remover(l)}"
						update="form tabelaLivros" />
				</p:column>


			</p:dataTable>
		</h:form>
	</ui:define>

</ui:composition>
</html>